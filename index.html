<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>a good hand</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />

  <script
    src="https://code.jquery.com/jquery-3.1.1.min.js"
    integrity="sha256-hVVnYaiADRTO2PzUGmuLJr8BLUSjGIZsDYGmIJLv2b8="
    crossorigin="anonymous"
  ></script>

  <!-- <script src="https://cdnjs.cloudflare.com/ajax/libs/tone/14.8.49/Tone.js"></script> -->

  <script src="tracery.js"></script>
  <script src="newgrammar.js"></script>

  <link rel="stylesheet" href="style.css" />

  <style>
    /* Minimal styles to make card symbols visible */
    .card-symbol {
      position: absolute;
      font-size: 24px;
      pointer-events: none;
      user-select: none;
      animation: floatUp 3s ease forwards;
    }

    @keyframes floatUp {
      from {
        opacity: 1;
        transform: translateY(0);
      }
      to {
        opacity: 0;
        transform: translateY(-50px);
      }
    }
  </style>
</head>
<body>

  <button class="w now title" id="1" onclick="movement(this)">
    a good hand
  </button>

  <div id="canvasHolder"></div>

  <details>
    <summary>ð“‚©</summary>
    <p id="summary">
      This is a project created by
      <a href="https://abbeyforeman.glitch.me/">Abbey Foreman</a> using the
      library
      <a href="https://github.com/galaxykate/tracery">tracery.js</a>. There
      are 4.9Ã—10^12 ways that this story can be generated. Thats over 4
      trillion ways! Whatever story you read is the only one of its kind.
    </p>
  </details>

  <!-- Button to trigger card appearance -->
  <button onclick="displayRandomCard()">Click to Show Random Card</button>

  <!-- Hidden Content for Clicked Card -->
  <div id="card-content" class="card-content"></div>

  <script>
    var grammar = tracery.createGrammar(source);
    var move = 1;
    var step = 2;

    function movement(origin) {
      onlyNow();
      let me = makeIt(origin, "me");

      if (move < 30) {
        move++;
      }
    }

    function onlyNow() {
      const buttons = document.querySelectorAll(".me, .w");
      for (const button of buttons) {
        if (button.hasAttribute("onclick")) {
          button.removeAttribute("onclick");
          button.disabled = true;
        }
        if (button.classList.contains("now")) {
          button.classList.remove("now");
        }
      }
    }

    function makeIt(source, interlocutor) {
      let sourceY = source.offsetTop;
      let sourceX = source.offsetLeft;

      // Create button and assign unique id
      let idea = document.createElement("button");
      let ideaId = step;
      idea.setAttribute("id", ideaId);
      idea.setAttribute("onclick", "movement(this)");
      idea.classList.add(interlocutor);
      idea.classList.add("now");

      // Add tracery text to button
      let sentence = grammar.flatten("#" + interlocutor + move + "#");
      idea.innerHTML = sentence;

      // Constrain the button's position within the viewport
      const top = getRandomNumber(50, window.innerHeight - 50);
      const left = getRandomNumber(50, window.innerWidth - 150);

      idea.style.position = "absolute";
      idea.style.top = `${top}px`;
      idea.style.left = `${left}px`;

      // Append the button to the canvasHolder
      document.getElementById("canvasHolder").appendChild(idea);

      step++;

      return ideaId;
    }

    function getRandomNumber(min, max) {
      return Math.floor(Math.random() * (max - min)) + min;
    }

    function connect(button1, button2, color, thickness) {
      var off1 = getOffset(button1);
      var off2 = getOffset(button2);
      var x1 = off1.left + off1.width;
      var y1 = off1.top + off1.height;
      var x2 = off2.left + off2.width;
      var y2 = off2.top;
      var length = Math.sqrt((x2 - x1) ** 2 + (y2 - y1) ** 2);
      var cx = (x1 + x2) / 2 - length / 2;
      var cy = (y1 + y2) / 2 - thickness / 2;
      var angle = Math.atan2(y1 - y2, x1 - x2) * (180 / Math.PI);
      var htmlLine =
        "<div style='opacity: 1; padding:0px; margin:0px; height:" +
        thickness +
        "px; background-color:" +
        color +
        "; line-height:1px; position:absolute; left:" +
        cx +
        "px; top:" +
        cy +
        "px; width:" +
        length +
        "px; transform:rotate(" +
        angle +
        "deg);' />";
      document.body.innerHTML += htmlLine;
    }

    function getOffset(el) {
      var rect = el.getBoundingClientRect();
      return {
        left: rect.left + window.pageXOffset,
        top: rect.top + window.pageYOffset,
        width: rect.width || el.offsetWidth,
        height: rect.height || el.offsetHeight,
      };
    }

    // Function to pick random item from array excluding one value (example)
    function pickRandomWithoutMatch(array, compareValue) {
      const shuffledArray = [...array];

      while (shuffledArray.length > 0) {
        const randomIndex = Math.floor(Math.random() * shuffledArray.length);
        if (shuffledArray[randomIndex] !== compareValue) {
          return shuffledArray[randomIndex];
        }
        shuffledArray.splice(randomIndex, 1);
      }
      throw new Error("No item in the array except the specified value.");
    }

    // Example usage of pickRandomWithoutMatch
    /*
    try {
      const pickedItem = pickRandomWithoutMatch(myArray, compareValue);
      console.log("Picked item:", pickedItem);
    } catch (error) {
      console.error(error.message);
    }
    */

    // Show a random card symbol in #card-content
    function displayRandomCard() {
      const cardSymbols = [
        "ðŸ‚±","ðŸ‚²","ðŸ‚³","ðŸ‚´","ðŸ‚µ","ðŸ‚¶","ðŸ‚·","ðŸ‚¸","ðŸ‚¹","ðŸ‚º","ðŸ‚»","ðŸ‚¼","ðŸ‚½","ðŸ‚¾","ðŸ‚¡",
        "ðŸ‚¢","ðŸ‚£","ðŸ‚¤","ðŸ‚¥","ðŸ‚¦","ðŸ‚§","ðŸ‚¨","ðŸ‚©","ðŸ‚ª","ðŸ‚«","ðŸ¬˜","ðŸ‚­","ðŸ‚®","ðŸƒ","ðŸƒ‚",
        "ðŸƒƒ","ðŸƒ„","ðŸƒ…","ðŸƒ†","ðŸƒ‡","ðŸƒˆ","ðŸƒ‰","ðŸƒŠ","ðŸƒ‹","ðŸƒŒ","ðŸƒ","ðŸƒŽ","ðŸƒ‘","ðŸƒ’","ðŸƒ“",
        "ðŸƒ”","ðŸƒ•","ðŸƒ–","ðŸƒ—","ðŸƒ˜","ðŸƒ™","ðŸƒš","ðŸƒ›","ðŸƒœ","ðŸƒ","ðŸƒž"
      ];

      const randomSymbol = cardSymbols[Math.floor(Math.random() * cardSymbols.length)];
      const cardContent = document.getElementById("card-content");
      cardContent.textContent = randomSymbol;
    }

    // Event listener to add floating card symbols anywhere clicked on body
    document.body.addEventListener("click", (event) => {
      const cardSymbols = [
        "ðŸ‚±","ðŸ‚²","ðŸ‚³","ðŸ‚´","ðŸ‚µ","ðŸ‚¶","ðŸ‚·","ðŸ‚¸","ðŸ‚¹","ðŸ‚º","ðŸ‚»","ðŸ‚¼","ðŸ‚½","ðŸ‚¾","ðŸ‚¡",
        "ðŸ‚¢","ðŸ‚£","ðŸ‚¤","ðŸ‚¥","ðŸ‚¦","ðŸ‚§","ðŸ‚¨","ðŸ‚©","ðŸ‚ª","ðŸ‚«","ðŸ¬˜","ðŸ‚­","ðŸ‚®","ðŸƒ","ðŸƒ‚",
        "ðŸƒƒ","ðŸƒ„","ðŸƒ…","ðŸƒ†","ðŸƒ‡","ðŸƒˆ","ðŸƒ‰","ðŸƒŠ","ðŸƒ‹","ðŸƒŒ","ðŸƒ","ðŸƒŽ","ðŸƒ‘","ðŸƒ’","ðŸƒ“",
        "ðŸƒ”","ðŸƒ•","ðŸƒ–","ðŸƒ—","ðŸƒ˜","ðŸƒ™","ðŸƒš","ðŸƒ›","ðŸƒœ","ðŸƒ","ðŸƒž"
      ];

      const randomSymbol = cardSymbols[Math.floor(Math.random() * cardSymbols.length)];
      const cardElement = document.createElement("div");
      cardElement.classList.add("card-symbol");
      cardElement.textContent = randomSymbol;

      const randomX = Math.random() * window.innerWidth;
      const randomY = Math.random() * window.innerHeight;

      cardElement.style.left = `${randomX}px`;
      cardElement.style.top = `${randomY}px`;

      document.body.appendChild(cardElement);

      // Remove the element after animation duration (3s)
      setTimeout(() => {
        cardElement.remove();
      }, 3000);
    });
  </script>

</body>
</html>
